# Facebook Scrapping

## Facebook GBV Private Groups

The scrapping process is powered by [kevinzg/facebook-scraper](https://github.com/kevinzg/facebook-scraper).

The main workflow is illustrated on the following diagram:

![Facebook Private Group Collection Workflow](https://github.com/OmdenaAI/SFCG/blob/task-3-scrap-facebook-private-groups/data_collection/facebook/resources/facebook-private-group-scrapping-flow.svg?raw=true)

Two main sources of information:

- [Combat Domestic Violence and Abuse Foundation (10.6k members)](https://m.facebook.com/groups/1640618112854783)
- [Domestic Violence (5.8k members)](https://m.facebook.com/groups/104190026414249)

### Dataset Format

The following type describes information that collected dataset contains: 

```python
class FacebookGroupPost(TypedDict):
    group_id: str  # a facebook group where post was found
    
    # post general information
    post_id: str
    post_url: str  # accessible post URL
    created_at: datetime
    post_text: str  # actual post text content

    author_id: str  # id of user who created the post
    author_username: str  # username of user who created a post

    external_link: str  # if post contains external links, the link will be here

    images: str  # JSON string of post image information (image URLs, autogenerated descriptions and image IDs) if post has images
    
    # post video information if post has videos
    video_id: str
    video: str
    video_duration_seconds: int
    video_thumbnail: str
    video_watches: int
    
    # post social interaction information
    likes_count: int
    comments_count: int
    shares_count: int
    reaction_count: int
    reactions: str  # JSON string of serialized reactions with user information
```

### Usage

The scrapping script `collect.py` exposes parameters to make it easier to use in a automated pipeline:

```bash
usage: collect.py [-h] --group_id GROUP_ID --cookie COOKIE [--save_every_n_posts SAVE_EVERY_N_POSTS] [--ban_timeout BAN_TIMEOUT] [--ignore_post_ids IGNORE_POST_IDS [IGNORE_POST_IDS ...]]

Collect information from private Facebook groups

optional arguments:
  -h, --help            show this help message and exit
  --group_id GROUP_ID   private group ID to scrap posts from. Could be found in group URL
  --cookie COOKIE       serialized cookies of account that has access to the private group. More information: https://github.com/kevinzg/facebook-scraper#optional-parameters
  --save_every_n_posts SAVE_EVERY_N_POSTS
                        how many posts to store in RAM before writing to the dataset
  --ban_timeout BAN_TIMEOUT
                        how many time (in seconds) should we wait on IP ban (600secs by default, e.g. 10mins)
  --ignore_post_ids IGNORE_POST_IDS [IGNORE_POST_IDS ...]
                        ignore posts by ID. For example, it may be helpful to ignore old announcement posts which may be outside of the time period of interest [--ignore_post_ids IGNORE_POST_IDS [IGNORE_POST_IDS ...]]
```

Examples of running `collect.py` script:

```bash
python collect.py --group_id 1640618112854783 --cookie ./tmp/cookie.json
python ./data_collection/facebook/collect.py --group_id 104190026414249 --cookie ./tmp/cookie.json --ignore_post_ids 887563314743579
```
